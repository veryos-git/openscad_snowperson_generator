
a_a_n_perlinvalue = [[0,0.04371501049860007,0.08722033582083583,0.13030754843957779,0.1727707290807501,0.21440770326171876,0.25502125679503873,0.2944203233645525,0.33242113738244095,0.36884834546283424,0.40353607,0.4363289185169384,0.4670828652695111,0.49566331659243307,0.5219399106061818,0.5457870263690396],[0.04371501049860007,0.08736008397760227,0.13072578697513126,0.1736041944028,0.21579013813823242,0.25708244055352997,0.2972851260189389,0.3362086035,0.3736708134708937,0.4094983324965232,0.44352742899110886,0.4756050638417031,0.5055898262476604,0.5333514795878082,0.5587654976458403,0.5817116150984001],[0.08722033582083583,0.13072578697513126,0.17388268513394686,0.21648385713099633,0.2583251328672,0.29920657483436763,0.33893368463359996,0.37731857962080306,0.41418113291896314,0.4493500701694812,0.48266401655291896,0.5139724877929687,0.5431368190663115,0.5700306131736044,0.594535517650221,0.6165374349016378],[0.13030754843957779,0.1736041944028,0.21648385713099633,0.25874036305528986,0.30017078456640633,0.3405766645435481,0.37976521690839377,0.41755049635354713,0.4537545305048455,0.48820840791239994,0.5207533154261265,0.5512415186978,0.5795372797633448,0.6055176397863267,0.6290707290220647,0.6500943989537166],[0.1727707290807501,0.21579013813823242,0.2583251328672,0.30017078456640633,0.34112564958560265,0.38099298787562946,0.41958195660613135,0.4567087720199813,0.49219783280639995,0.5258827984130457,0.5576076158810573,0.587227488976129,0.6146097849201343,0.6396359210111869,0.662206554837258,0.6822373371170211],[0.21440770326171876,0.25708244055352997,0.29920657483436763,0.3405766645435481,0.38099298787562946,0.420260754375,0.45819129065389763,0.4946031934255237,0.5293234431596393,0.5621884718091422,0.5930451782226563,0.6217518953257596,0.6481810427002465,0.6722263455320789,0.6938039866789638,0.7128460828882642],[0.25502125679503873,0.2972851260189389,0.33893368463359996,0.37976521690839377,0.41958195660613135,0.45819129065389763,0.4954069360076391,0.5310500829275687,0.564950498,0.596947580385157,0.6268913931238593,0.6546460632805907,0.6800976523990508,0.7031550090100233,0.7237476359875729,0.7418217091016776],[0.2944203233645525,0.3362086035,0.37731857962080306,0.41755049635354713,0.4567087720199813,0.4946031934255237,0.5310500829275687,0.5658734310288795,0.5989059878627291,0.6299903536522652,0.6589829829723339,0.6857626661044685,0.7102310964581715,0.7323106032945793,0.7519421754146434,0.7690832226289727],[0.33242113738244095,0.3736708134708937,0.41418113291896314,0.4537545305048455,0.49219783280639995,0.5293234431596393,0.564950498,0.5989059878627291,0.6310258907814842,0.6611595456661254,0.6891788234523578,0.7149786937642968,0.7384747958145947,0.7596013262028135,0.7783092430338908,0.7945646957210145],[0.36884834546283424,0.4094983324965232,0.4493500701694812,0.48820840791239994,0.5258827984130457,0.5621884718091422,0.596947580385157,0.6299903536522652,0.6611595456661254,0.6903204096764137,0.717361594055863,0.742192541698995,0.7647412196968839,0.7849521911726265,0.8027849928725258,0.8182127836777608],[0.40353607,0.44352742899110886,0.48266401655291896,0.5207533154261265,0.5576076158810573,0.5930451782226563,0.6268913931238593,0.6589829829723339,0.6891788234523578,0.717361594055863,0.7434350064739345,0.7673213527036792,0.7889594223669012,0.8083027515319886,0.8253181669599302,0.8399845913248927],[0.4363289185169384,0.4756050638417031,0.5139724877929687,0.5512415186978,0.587227488976129,0.6217518953257596,0.6546460632805907,0.6857626661044685,0.7149786937642968,0.742192541698995,0.7673213527036792,0.7902987562872568,0.8110729664912164,0.8296052007869339,0.8458683842983014,0.8598461052260215],[0.4670828652695111,0.5055898262476604,0.5431368190663115,0.5795372797633448,0.6146097849201343,0.6481810427002465,0.6800976523990508,0.7102310964581715,0.7384747958145947,0.7647412196968839,0.7889594223669012,0.8110729664912164,0.8310381944558989,0.8488228105679042,0.8644047387157759,0.877771221691901],[0.49566331659243307,0.5333514795878082,0.5700306131736044,0.6055176397863267,0.6396359210111869,0.6722263455320789,0.7031550090100233,0.7323106032945793,0.7596013262028135,0.7849521911726265,0.8083027515319886,0.8296052007869339,0.8488228105679042,0.8659286695035595,0.8809046879206804,0.8937408348982974],[0.5219399106061818,0.5587654976458403,0.594535517650221,0.6290707290220647,0.662206554837258,0.6938039866789638,0.7237476359875729,0.7519421754146434,0.7783092430338908,0.8027849928725258,0.8253181669599302,0.8458683842983014,0.8644047387157759,0.8809046879206804,0.8953531989814297,0.9077421170861273],[0.5457870263690396,0.5817116150984001,0.6165374349016378,0.6500943989537166,0.6822373371170211,0.7128460828882642,0.7418217091016776,0.7690832226289727,0.7945646957210145,0.8182127836777608,0.8399845913248927,0.8598461052260215,0.877771221691901,0.8937408348982974,0.9077421170861273,0.9197680131397817]];


module custom_sphere(r = 10, lat_divs = 16, lon_divs = 16) {
    // Generate points
    points = [
        [0, 0, r],  // top pole
        for (lat = [1:lat_divs-1])
            for (lon = [0:lon_divs-1])
                let(
                    theta = lat * 180 / lat_divs,
                    phi = lon * 360 / lon_divs, 
                    r_offset = a_a_n_perlinvalue[lat][lon],
                    r2 = r+r_offset
                )
                [
                    r2 * sin(theta) * cos(phi),
                    r2 * sin(theta) * sin(phi),
                    r2 * cos(theta)
                ],
        [0, 0, -r]  // bottom pole
    ];
    
    // Generate faces
    faces = concat(
        // Top cap triangles
        [for (lon = [0:lon_divs-1])
            [0, 1 + lon, 1 + (lon + 1) % lon_divs]
        ],
        
        // Middle quads (as two triangles each)
        [for (lat = [0:lat_divs-3])
            for (lon = [0:lon_divs-1])
                let(
                    tl = 1 + lat * lon_divs + lon,
                    tr = 1 + lat * lon_divs + (lon + 1) % lon_divs,
                    bl = 1 + (lat + 1) * lon_divs + lon,
                    br = 1 + (lat + 1) * lon_divs + (lon + 1) % lon_divs
                )
                each [[tl, bl, br], [tl, br, tr]]
        ],
        
        // Bottom cap triangles
        [for (lon = [0:lon_divs-1])
            let(bottom_ring_start = 1 + (lat_divs - 2) * lon_divs)
            [len(points) - 1, bottom_ring_start + (lon + 1) % lon_divs, bottom_ring_start + lon]
        ]
    );
    
    polyhedron(points, faces);
}

custom_sphere(r = 10, lat_divs = 16, lon_divs = 16);